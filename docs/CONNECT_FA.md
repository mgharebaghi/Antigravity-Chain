# اتصال به شبکه آنتی‌گرویتی (RPC/REST)

این راهنما توضیح می‌دهد که چگونه صرافی‌ها، کیف پول‌ها و سرویس‌های خارجی می‌توانند با استفاده از `rpc_node` به **شبکه آنتی‌گرویتی** متصل شوند.

## بررسی اجمالی

شبکه آنتی‌گرویتی یک بلاکچین نظیر-به-نظیر (P2P) است. برای تعامل با آن از سیستم‌های خارجی (مانند وب‌سایت صرافی یا سرورها)، شما باید یک **RPC Node** را اجرا کنید. این نود به عنوان یک پل عمل می‌کند: در شبکه P2P مشارکت می‌کند و یک API استاندارد HTTP JSON-REST را برای برنامه شما فراهم می‌کند.

## ۱. اجرای نود RPC

نود RPC یک باینری بدون رابط گرافیکی (Headless) است که در سورس کد موجود است.

### پیش‌نیازها
- ویندوز / لینوکس / مک
- ابزار Rust (برای بیلد کردن)
- دسترسی به اینترنت (پورت‌های P2P)

### ساخت و اجرا
به پوشه `src-tauri` بروید و دستور زیر را اجرا کنید:

```bash
cd src-tauri
cargo run --release --bin rpc_node
```

نود شروع به کار کرده و روی پورت‌های زیر گوش می‌دهد:
- **پورت API**: `3000` (HTTP & WebSocket)
- **پورت P2P**: `9091` (TCP)

> **نکته**: اگر می‌خواهید با نودهای خارجی ارتباط برقرار کنید، مطمئن شوید پورت `9091` باز است.

## ۲. مستندات API

تمام خروجی‌ها به صورت JSON هستند.

### آدرس پایه: `http://localhost:3000/api/v1`

### دریافت وضعیت نود (Status)
**GET** `/status`

بررسی وضعیت همگام‌سازی و سلامت نود.

**پاسخ:**
```json
{
  "node_type": "RPC",
  "chain_height": 1205,
  "peer_count": 8,
  "network": "Antigravity Mainnet"
}
```

### آمار شبکه (Network Stats)
**GET** `/network/stats`

دریافت آمار دقیق شبکه (تعداد کل کوین‌ها، هاوینگ، سختی شبکه).

**پاسخ:**
```json
{
  "supply": 5000000000000,
  "max_supply": 21000000000000,
  "circulating": 5000000000000,
  "halving_block": 100000,
  "current_reward": 40000000,
  "mining_difficulty": 200000
}
```

### دریافت موجودی (Balance)
**GET** `/balance/:address`

دریافت موجودی *قابل برداشت* یک آدرس (موجودی کل منهای تراکنش‌های در انتظار).

**مثال:**
`GET /balance/12D3KooWD...`

**پاسخ:**
```json
{
  "address": "12D3KooWD...",
  "balance": 5000000000,
  "currency": "AGT"
}
```
*(موجودی بر اساس واحد پایه است. ۱ AGT = ۱,۰۰۰,۰۰۰ واحد)*

### لیست بلاک‌ها (Paginated)
**GET** `/blocks?page=0&limit=20`

دریافت لیست بلاک‌ها به صورت صفحه بندی شده.

**پاسخ:**
```json
[
  { "index": 105, "hash": "...", "transactions": [...] },
  { "index": 104, "hash": "...", "transactions": [...] }
]
```

### دریافت جزئیات تراکنش
**GET** `/transactions/:id`

دریافت اطلاعات یک تراکنش با استفاده از ID (UUID).

**پاسخ:**
```json
{
  "transaction": {
    "id": "550e8400-e29b-...",
    "sender": "12D3...",
    "receiver": "12D3...",
    "amount": 1000000,
    "timestamp": 1678888888,
    "signature": "..."
  },
  "status": "confirmed", // یا "pending"
  "block_index": 105,
  "block_hash": "a1b2..."
}
```

### ارسال تراکنش (Broadcast)
**POST** `/broadcast`

ارسال یک تراکنش امضا شده به شبکه.

**ورودی (Payload):**
```json
{
  "transaction": {
    "id": "generated-uuid",
    "sender": "your-public-key-id",
    "receiver": "dest-public-key-id",
    "amount": 1000000,
    "timestamp": 1234567890,
    "signature": "hex-encoded-signature"
  }
}
```

**پاسخ:**
```json
{
  "status": "accepted",
  "tx_id": "generated-uuid"
}
```

## ۳. آپدیت‌های لحظه‌ای (WebSocket)

برای دریافت رویدادهای زنده شبکه (مانند بلاک جدید یا تراکنش جدید) به آدرس زیر متصل شوید:

**URL**: `ws://localhost:3000/ws`

### رویدادها (Events)

#### بلاک جدید (New Block)
زمانی که یک بلاک جدید استخراج و تایید می‌شود.
```json
{
  "type": "NewBlock",
  "data": {
    "index": 106,
    "hash": "...",
    "transactions": [...]
  }
}
```

#### تراکنش جدید (New Transaction)
زمانی که یک تراکنش معتبر وارد صف (Mempool) می‌شود.
```json
{
  "type": "NewTransaction",
  "data": {
    "id": "...",
    "sender": "...",
    "amount": 1000000
  }
}
```

## ۴. بهترین روش‌های ادغام (Best Practices)

- **همگام‌سازی (Syncing)**: وقتی `rpc_node` را برای اولین بار اجرا می‌کنید، چند دقیقه صبر کنید تا همتایان (Peers) را پیدا کند و بلاکچین را دانلود کند. قبل از همگام‌سازی کامل، به داده‌های موجودی اعتماد نکنید.
- **پایداری (Failover)**: می‌توانید چندین نمونه از `rpc_node` را پشت یک Load Balancer (مثل Nginx) اجرا کنید تا همیشه سرویس در دسترس باشد.
- **امنیت**: API این نود کلید خصوصی تولید نمی‌کند و تراکنش را امضا نمی‌کند. شما باید کلیدهای خصوصی کاربران را در سیستم امن خود (Cold Wallet) مدیریت کنید و فقط تراکنش‌های امضا شده را برای نود بفرستید.

---
*تیم توسعه آنتی‌گرویتی*
